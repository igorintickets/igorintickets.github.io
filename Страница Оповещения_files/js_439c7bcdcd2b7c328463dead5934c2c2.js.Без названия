$(function(){Vue.component("customer-inform-list",{template:"\n      <div id=\"customer_inform_block\">\n        <table class=\"compact row-border stripe hover dataTable\">\n          <thead>\n          <tr>\n            <th>\u041A\u0430\u0431\u0438\u043D\u0435\u0442</th>\n            <th>\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043A\u0430\u043C\u043F\u0430\u043D\u0438\u0438</th>\n            <th>\u041A\u043E\u043B-\u0432\u043E</th>\n            <th>\u0421\u0442\u0430\u0442\u0443\u0441</th>\n            <th>\u0421\u043E\u0437\u0434\u0430\u043D\u0430</th>\n            <th>\u041E\u0442\u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0430</th>\n            <th>\u041E\u043F\u0435\u0440\u0430\u0446\u0438\u0438</th>\n          </tr>\n          </thead>\n          <tbody>\n          <tr class=\"odd\" v-if=\"campaigns.length === 0\">\n            <td colspan=\"7\" class=\"table-message\">\u041D\u0435\u0442 \u0437\u0430\u043F\u0438\u0441\u0435\u0439</td>\n          </tr>\n          <tr :class=\"(index + 1) % 2 ? 'odd' : 'even'\" v-for=\"(row, index) in campaigns\" v-else>\n            <td>{{row.cabinet_name}}</td>\n            <td>\n              <template v-if=\"['draft', 'testing'].indexOf(row.status) > -1\">\n                <a href=\"javascript:\" @click=\"edit(row.campaign_id)\">{{row.name}}</a>\n              </template>\n              <template v-else>\n                {{row.name}}\n              </template>\n            </td>\n            <td>{{row.mail_count}}</td>\n            <td>{{decInternalStatus(row)}}</td>\n            <td>{{row.created_at}}<br>{{row.created_name}}</td>\n            <td>{{row.updated_at}}<br>{{row.updated_name}}</td>\n            <td>\n              <a href=\"javascript:\" v-if=\"row.status == 'draft'\" @click=\"test(row.campaign_id)\">\u0422\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C</a>\n              <a href=\"javascript:\" v-else-if=\"row.status == 'testing'\" @click=\"send(row.campaign_id)\">\u041E\u0442\u043F\u0440\u0430\u0432\u0438\u0442\u044C</a>\n              <a href=\"javascript:\" v-else @click=\"check(row.campaign_id)\">\u041E\u0431\u043D\u043E\u0432\u0438\u0442\u044C \u0441\u0442\u0430\u0442\u0443\u0441</a>\n            </td>\n          </tr>\n          </tbody>\n        </table>\n        <div class=\"right-container\">\n            <button @click=\"add()\">\u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C</button>\n        </div>\n        <div class=\"wait-overlay\" v-if=\"wait\"><div>\u231B</div></div>\n      </div>\n    ",data:function data(){return{campaigns:Drupal.settings.customer_inform_list.inform_list,mail:Drupal.settings.customer_inform_list.current_user_mail,csrf:Drupal.settings.customer_inform_list.csrf,wait:!1}},methods:{decInternalStatus:function decInternalStatus(row){var proc=0;switch("sending"===row.status&&(proc=Math.floor(100*(row.sent_count/row.mail_count))),row.status){case"draft":return"\u0447\u0435\u0440\u043D\u043E\u0432\u0438\u043A";case"testing":return"\u0442\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435";case"sending":return Number.isNaN(proc)?"\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430":"\u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 "+proc+"%";case"sent":return"\u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E";default:return"";}},decExternalStatus:function decExternalStatus(status){switch(parseInt(status)){case 0:return"\u041D\u043E\u0432\u043E\u0435 \u0437\u0430\u0434\u0430\u043D\u0438\u0435 \u043D\u0430 \u0440\u0430\u0441\u0441\u044B\u043B\u043A\u0443";case 1:return"\u041E\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 (\u043D\u0430 \u043C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u0438)";case 2:return"\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u0442\u0441\u044F";case 3:return"\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E";case 4:return"\u0422\u0435\u0441\u0442\u043E\u0432\u0430\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 (\u043D\u0430 \u0438\u043C\u0435\u0439\u043B \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F)";case 5:return"\u0420\u0430\u0441\u0441\u044B\u043B\u043A\u0430 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u0430 (\u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0435\u0439)";case 6:return"\u0420\u0430\u0441\u0441\u044B\u043B\u043A\u0430 \u043F\u043E\u043C\u0435\u0447\u0435\u043D\u0430 \u0434\u043B\u044F \u0443\u0434\u0430\u043B\u0435\u043D\u0438\u044F";case 7:return"\u041E\u0431\u043D\u043E\u0432\u043B\u0435\u043D\u0438\u0435 \u0441\u0442\u0430\u0442\u0443\u0441\u043E\u0432 (\u043F\u043E\u0441\u043B\u0435\u0434\u0443\u0435\u0442 \u0441\u0442\u0430\u0442\u0443\u0441 \xAB\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E\xBB)";case 8:return"\u0422\u0435\u0441\u0442\u043E\u0432\u0430\u044F \u043A\u0430\u043C\u043F\u0430\u043D\u0438\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430";case 9:return"\u0418\u0434\u0435\u0442 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430";case 10:return"\u041E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0435\u0442\u0441\u044F, \u0433\u043E\u0442\u043E\u0432\u0438\u0442\u0441\u044F \u043A \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0435";case 11:return"\u041E\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044F \u043E\u0442\u0432\u0435\u0442 \u043E\u0442 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044F \u043D\u0430 \u0443\u0442\u043E\u0447\u043D\u044F\u044E\u0449\u0438\u0439 \u0432\u043E\u043F\u0440\u043E\u0441 \u043C\u043E\u0434\u0435\u0440\u0430\u0442\u043E\u0440\u0430";case 12:return"\u041D\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u043D\u044B\u0445 \u0430\u0434\u0440\u0435\u0441\u043E\u0432";case 13:return"\u041A\u0430\u043C\u043F\u0430\u043D\u0438\u044F \u0432 \u043F\u0440\u043E\u0446\u0435\u0441\u0441\u0435 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u2014 \u0430\u0434\u0440\u0435\u0441\u0430 \u0438\u0437 \u0430\u0434\u0440\u0435\u0441\u043D\u043E\u0439 \u043A\u043D\u0438\u0433\u0438 \u043F\u0435\u0440\u0435\u043D\u043E\u0441\u044F\u0442\u0441\u044F \u0432 \u043A\u0430\u043C\u043F\u0430\u043D\u0438\u044E. \u041F\u043E\u0441\u043B\u0435 \u043E\u043A\u043E\u043D\u0447\u0430\u043D\u0438\u044F \u043F\u0435\u0440\u0435\u043D\u043E\u0441\u0430 \u0432\u044B\u0441\u0442\u0430\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0441\u0442\u0430\u0442\u0443\u0441 \xAB\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u0442\u0441\u044F\xBB \u0434\u043B\u044F \u0430\u0434\u0440\u0435\u0441\u043E\u0432 \u043C\u0435\u043D\u044C\u0448\u0435 20-\u0442\u0438 \u0438\u043B\u0438 \xAB\u041E\u0436\u0438\u0434\u0430\u0435\u0442\u0441\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 (\u043D\u0430 \u043C\u043E\u0434\u0435\u0440\u0430\u0446\u0438\u0438\xBB \u0432 \u0438\u043D\u043E\u043C \u0441\u043B\u0443\u0447\u0430\u0435.";case 14:return"\u041A\u0430\u043C\u043F\u0430\u043D\u0438\u044F \u0441\u043E\u0437\u0434\u0430\u043D\u0430 \u0438 \u043E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0432 \u043E\u0447\u0435\u0440\u0435\u0434\u044C \u0434\u043B\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438. \u041F\u043E\u0441\u043B\u0435 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438 \u0441\u0442\u0430\u0442\u0443\u0441 \u0438\u0437\u043C\u0435\u043D\u0438\u0442\u0441\u044F \u043D\u0430 \xAB\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u043E\xBB";case 15:return"\u041A\u0430\u043C\u043F\u0430\u043D\u0438\u044F \u043E\u0436\u0438\u0434\u0430\u0435\u0442 \u0438\u0442\u043E\u0433\u0430 A/B \u0442\u0435\u0441\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u044F";case 16:return"\u041E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 \u043A\u0430\u043C\u043F\u0430\u043D\u0438\u0438 \u043E\u0442\u043C\u0435\u043D\u0435\u043D\u0430 \u043F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u0435\u043C";case 22:return"\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u0447\u0430\u0441\u0442\u0438\u0447\u043D\u043E";case 23:return"\u041E\u0442\u043F\u0440\u0430\u0432\u043B\u0435\u043D\u0430 \u0447\u0430\u0441\u0442\u0438\u0447\u043D\u043E";case 25:return"\u0420\u0430\u0441\u0441\u044B\u043B\u043A\u0430 \u0437\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u0430\u0434\u043C\u0438\u043D\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0435\u0439 \u043F\u043E\u0441\u043B\u0435 \u0447\u0430\u0441\u0442\u0438\u0447\u043D\u043E\u0439 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438";case 26:return"\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A";case 27:return"\u041D\u0435\u043E\u0431\u0445\u043E\u0434\u0438\u043C\u043E \u0440\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u043D\u0438\u0435";case 28:return"\u0417\u0430\u043F\u043B\u0430\u043D\u0438\u0440\u043E\u0432\u0430\u043D\u0430 \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0430 \u043F\u043E \u043D\u0435\u043F\u0440\u043E\u0447\u0438\u0442\u0430\u043D\u043D\u044B\u043C";case 33:return"\u0410\u0432\u0442\u043E\u0441\u0435\u0440\u0438\u0438. \u0414\u043B\u044F \u043E\u0442\u043F\u0440\u0430\u0432\u043A\u0438 \u0440\u0430\u0441\u0441\u044B\u043B\u043A\u0438 \u043D\u0435 \u0445\u0432\u0430\u0442\u0438\u043B\u043E \u0441\u0440\u0435\u0434\u0441\u0442\u0432 \u043D\u0430 \u0431\u0430\u043B\u0430\u043D\u0441\u0435";case 36:return"\u0427\u0435\u0440\u043D\u043E\u0432\u0438\u043A \u0430\u0432\u0442\u043E\u0441\u0435\u0440\u0438\u0438";default:return"";}},add:function add(){location.href="/customer_inform/edit/new"},edit:function edit(id){location.href="/customer_inform/edit/"+id},test:function test(id){var _this=this;swal({html:"<div class=\"form-item\"><label>Email:</label><input class=\"form-text\" id=\"email_for_test\" type=\"email\" placeholder=\"Email\" value=\""+this.mail+"\"/></div>",type:"question",preConfirm:function preConfirm(){return new Promise(function(resolve){resolve({Email:$("input#email_for_test").val()})})}}).then(function(input){var data={csrf:_this.csrf,campaign_id:id,emails:[input.Email]};_this.wait=!0,_this.$http.post("/customer_inform/ajax/test",data).then(function(responce){if(responce.data.message&&swal("",responce.data.message,"error"),responce.data.campaign){var index=_this.campaigns.findIndex(function(el){return el.campaign_id===id});-1<index&&(_this.campaigns[index].status=responce.data.campaign.internal_status,_this.campaigns[index].updated_at=responce.data.campaign.updated_at,_this.campaigns[index].updated_name=responce.data.campaign.updated_name,_this.campaigns[index].updated_uid=responce.data.campaign.updated_uid)}}).catch(function(){swal("","\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430","error")}).finally(function(){_this.wait=!1})})},send:function send(id){var _this2=this,data={csrf:this.csrf,campaign_id:id};this.wait=!0,this.$http.post("/customer_inform/ajax/send",data).then(function(responce){if(responce.data.message&&swal("",responce.data.message,"error"),responce.data.campaign){var index=_this2.campaigns.findIndex(function(el){return el.campaign_id===id});-1<index&&(_this2.campaigns[index].status=responce.data.campaign.internal_status,_this2.campaigns[index].updated_at=responce.data.campaign.updated_at,_this2.campaigns[index].updated_name=responce.data.campaign.updated_name,_this2.campaigns[index].updated_uid=responce.data.campaign.updated_uid)}}).catch(function(){swal("","\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430","error")}).finally(function(){_this2.wait=!1})},check:function check(id){var _this3=this,data={csrf:this.csrf,campaign_id:id};this.wait=!0,this.$http.post("/customer_inform/ajax/check",data).then(function(responce){if(responce.data.message&&swal("",responce.data.message,"error"),responce.data.campaign){var index=_this3.campaigns.findIndex(function(el){return el.campaign_id===id});-1<index&&(_this3.campaigns[index].status=responce.data.campaign.internal_status,_this3.campaigns[index].updated_at=responce.data.campaign.updated_at,_this3.campaigns[index].updated_name=responce.data.campaign.updated_name,_this3.campaigns[index].updated_uid=responce.data.campaign.updated_uid,_this3.campaigns[index].sendpulse_status=responce.data.campaign.sendpulse_status,_this3.campaigns[index].sendpulse_sent_count=responce.data.campaign.sendpulse_sent_count,_this3.campaigns[index].sendpulse_delivered_count=responce.data.campaign.sendpulse_delivered_count,_this3.campaigns[index].sendpulse_opened_count=responce.data.campaign.sendpulse_opened_count,_this3.campaigns[index].sendpulse_linked_count=responce.data.campaign.sendpulse_linked_count,_this3.campaigns[index].sendpulse_error_count=responce.data.campaign.sendpulse_error_count)}}).catch(function(){swal("","\u041F\u0440\u043E\u0438\u0437\u043E\u0448\u043B\u0430 \u043E\u0448\u0438\u0431\u043A\u0430","error")}).finally(function(){_this3.wait=!1})}}}),new Vue({el:"#customer-inform"})});;
